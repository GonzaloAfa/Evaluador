import httplib, urllib, cStringIO

from StringIO import StringIO
from PIL import Image


def getAsistenciaDiputado(prmid):

	server = "www.camara.cl"
	url    = "/camara/diputado_detalle.aspx?prmid="

	params = urllib.urlencode({
		'ctl00$ArbolPlaceHolder$ScriptManager1': 'ctl00$mainPlaceHolder$UpdatePanel1|ctl00$mainPlaceHolder$btnasistencia',
		'ctl00$mainPlaceHolder$Regiones':'0',
		'__EVENTTARGET':'ctl00$mainPlaceHolder$btnasistencia',
		'__EVENTARGUMENT':'',
		'__VIEWSTATE':'/wEPDwUJNjgwNDU3NjU1DxYGHgVpZGRpcAUDOTY4Hg5ub21icmVkaXB1dGFkbwUSSmVubnkgQWx2YXJleiBWZXJhHgdwcmVmaWpvBQhEaXB1dGFkYRYCZg9kFgICAw9kFgICBw9kFgYCAg9kFgICAQ8PFgIeCEltYWdlVXJsBRxtZWRpYS9pbWFnZXMvaGVtaWNpY2xvLzIuanBnZGQCBw9kFgICAQ8WAh4LXyFJdGVtQ291bnQCBBYIZg9kFgJmDxUCAjE5IcK/UXXDqSBlcyB1biBEaXB1dGFkbyBpbmZvcm1hbnRlP2QCAQ9kFgJmDxUCAjIwHsK/UXXDqSBlcyBsYSBzZW1hbmEgZGlzdHJpdGFsP2QCAg9kFgJmDxUCAjIxHcK/UXXDqSBlcyB1biBwcm95ZWN0byBkZSBsZXk/ZAIDD2QWAmYPFQICMjIWwr9RdcOpIGVzIHVuIGRpc3RyaXRvP2QCCA9kFgJmD2QWAgIMDw8WAh4HVmlzaWJsZWdkFgICBw9kFgoCAQ8PFgIeBFRleHQFATFkZAIDDw8WAh8GBQIxNWRkAgUPDxYCHwYFAjE1ZGQCBw8WAh8EAg8WHmYPZBYCZg8VBhIyMiBkZSBKdWwuIGRlIDIwMTQEMzgyOAMxMTfeAVNvbGljaXRhIGEgUy5FLiBsYSBQcmVzaWRlbnRhIGRlIGxhIFJlcMO6YmxpY2EgcXVlIGFkb3B0ZSBsYXMgbWVkaWRhcyBwZXJ0aW5lbnRlcyBwYXJhIHF1ZSBlbCBNaW5pc3RlcmlvIGRlIEJpZW5lcyBOYWNpb25hbGVzIGNvbnRyYXRlIGFsIG1lbm9zIHVuIHByb2Zlc2lvbmFsIGdlb21lbnNvciBlbiBDaGlsb8OpIHkgZGVjcmV0ZSBvdHJhcyBtZWRpZGFzIGVuIGVzdGEgbWF0ZXJpYS4NCghBcHJvYmFkbwQzODI4ZAIBD2QWAmYPFQYSMTUgZGUgSnVsLiBkZSAyMDE0BDM4MjQDMTEzYSJTb2xpY2l0YSBwb2zDrXRpY2EgZGUgYXBveW8gYSBsYXMgbWljcm8geSBwZXF1ZcOxYXMgZW1wcmVzYXMgZGUgbGFzIHpvbmFzIGFpc2xhZGFzIGRlbCBwYcOtcyIuDQoIQXByb2JhZG8EMzgyNGQCAg9kFgJmDxUGEjE0IGRlIEp1bC4gZGUgMjAxNAQzODIwAzEwOYoBIlNvbGljaXRhIGEgUy5FLiBsYSBQcmVzaWRlbnRhIGRlIGxhIFJlcMO6YmxpY2EgbWVqb3JhciBsYXMgY29uZGljaW9uZXMgbGFib3JhbGVzIHkgcmVtdW5lcmFjaW9uYWxlcyBkZSBsb3MgYXNpc3RlbnRlcyBkZSBsYSBlZHVjYWNpw7NuIg0KCEFwcm9iYWRvBDM4MjBkAgMPZBYCZg8VBhIwOSBkZSBKdWwuIGRlIDIwMTQEMzgxNwMxMDafASJTb2xpY2l0YXIgYSBsYXMgTWluaXN0cmFzIGRlIFNhbHVkIHkgZGVsIFNlcnZpY2lvIE5hY2lvbmFsIGRlIGxhIE11amVyIHF1ZSBlbGFib3JlbiBwb2zDrXRpY2FzIHDDumJsaWNhcyBkZSBhY29tcGHDsWFtaWVudG8gYSBsb3MgZW1iYXJhem9zIGRlIGFsdG8gcmllc2dvLiINCghBcHJvYmFkbwQzODE3ZAIED2QWAmYPFQYSMDggZGUgSnVsLiBkZSAyMDE0BDM4MTYBMogBIkV4aWdpciBsYSBwZXJzZWN1Y2nDs24gZGUgcmVzcG9uc2FiaWxpZGFkZXMgYWRtaW5pc3RyYXRpdmFzIGVuIGVsIGNvbXByb21pc28gZGUgY29uc3RydWNjacOzbiBkZSBsb3MgSG9zcGl0YWxlcyBkZSBBbmN1ZCB5IFF1ZWxsw7NuLiINCghBcHJvYmFkbwQzODE2ZAIFD2QWAmYPFQYSMDEgZGUgSnVsLiBkZSAyMDE0BDM4MDECOTN3IlJlY29ub2NpbWllbnRvIHkgcmVwYXJhY2nDs24gcGFyYSBsb3MgdHJhYmFqYWRvcmVzIGV4b25lcmFkb3MgcG9yIGVsIEdvYmllcm5vIGRlbCBleCBQcmVzaWRlbnRlIFNlYmFzdGnDoW4gUGnDsWVyYS4iDQoIQXByb2JhZG8EMzgwMWQCBg9kFgJmDxUGEjEyIGRlIEp1bi4gZGUgMjAxNAQzNzkyAjg0SiJTb2xpY2l0YSBsYSBjcmVhY2nDs24gZGXDsSBUcmlidW5hbCBkZSBDb21wZXRlbmNpYSBNaXh0YSBlbiBNZWppbGxvbmVzIg0KCEFwcm9iYWRvBDM3OTJkAgcPZBYCZg8VBhIxMiBkZSBKdW4uIGRlIDIwMTQEMzc5MQI4M9wBIlNvbGljaXRhIGEgUy5FLiBsYSBQcmVzaWRlbnRhIGRlIGxhIFJlcMO6YmxpY2EgcXVlIHJlbWl0YSBhIHRyYW1pdGFjaW9uIGxlZ2lzbHRpdmEgdW5hIGluaWNpYXRpdmEgcXVlIGxpYmVyZSBkZSB0YXNhcyBlIGltcHVlc3RvcyBkZSBpbnRlcm5hY2nDs24gbGEgaW1wb3J0YWNpw7NuIGRlIGJpZW5lcyBkZXN0aW5hZG9zIGEgbGEgaW52ZXN0aWdhY2nDs24gYXN0cm9mw61zaWNhLiINCghBcHJvYmFkbwQzNzkxZAIID2QWAmYPFQYSMTEgZGUgSnVuLiBkZSAyMDE0BDM3ODcCNzlWIlNvbGljaXRhIGEgbGEgQ09OQURJIGVsIGVzdHVkaW8geSBjcmVhY2nDs24gZGUgdW5hIERpcmVjZmNpw7NuIFJlZ2lvbmFsIGVuIEF5c8Opbi4iDQoIQXByb2JhZG8EMzc4N2QCCQ9kFgJmDxUGEjEwIGRlIEp1bi4gZGUgMjAxNAQzNzg2Ajc4RyJTb2xpY2l0YSBlbCBjdW1wbGltaWVudG8gZGUgbGEgZGV1ZGEgaGlzdMOzcmljYSBjb24gbG9zIHByb2Zlc29yZXMuIg0KCEFwcm9iYWRvBDM3ODZkAgoPZBYCZg8VBhIxNSBkZSBNYXkuIGRlIDIwMTQEMzc2NwI2MZ0BIlNvbGljaXRhIGNhbWJpb3MgYWwgSW5zdGl0dXRvIGRlIEZvbWVudG8gUGVzcXVlcm8gZm9ydGFsZWNpZW5kbyBzdSByb2wsIHN1IHJlY29ub2NpbWllbnRvIHBvciBsZXksIG51ZXZhcyBhdHJpYnVjaW9uZXMgeSBudWV2YSBkZXBlbmRlbmNpYSBpbnN0aXR1Y2lvbmFsLiINCghBcHJvYmFkbwQzNzY3ZAILD2QWAmYPFQYSMTUgZGUgQWJyLiBkZSAyMDE0BDM3NDECMzKBASJWYWxvcmFyIGVsIGN1bXBsaW1pZW50byBkZSBsYXMgbWVkaWRhcyBjb21wcm9tZXRpZGFzIHBhcmEgbGEgYWdyaWN1bHR1cmEgeSByYXRpZmljYXIgZWwgY29tcHJvbWlzbyBjb24gbGEgUmVmb3JtYSBUcmlidXRhcmlhLiINCghBcHJvYmFkbwQzNzQxZAIMD2QWAmYPFQYSMDkgZGUgQWJyLiBkZSAyMDE0BDM3MjgCMjLEASJTb2xpY2l0YSBhIFMuRS4gbGEgUHJlc2lkZW50YSBkZSBsYSByZXDDumJsaWNhIHF1ZSByZWluY29ycG9yZSBhIGxhIGNvbmRpY2nDs24gZGUgem9uYSBkZSBpbnRlcsOpcyB0dXLDrXN0aWNvIGEgbGFzIGxvY2FsaWRhZGVzIGNvbnRlbmlkYXMgZW4gZWwgRGVjcmV0byBFeGVudG8gTsKwIDE0MCwgZGUgMTAgZGUgbWFyem8gZGUgMjAxNC4iDQoIUmV0aXJhZG8EMzcyOGQCDQ9kFgJmDxUGEjAxIGRlIEFici4gZGUgMjAxNAQzNzE0ATlhIlNvbGljaXRhIGEgUy5FLiBsYSBQcmVzaWRlbnRhIGRlIGxhIFJlcMO6YmxpY2EgcXVlIGV2YWzDumUgbGEgcmF0aWZpY2FjacOzbiBkZWwgQ29udmVuaW8gMTg5LiINCghBcHJvYmFkbwQzNzE0ZAIOD2QWAmYPFQYSMjAgZGUgTWFyLiBkZSAyMDE0BDM3MTIBN7IBIlNvbGljaXRhIFMuRS4gbGEgUHJlc2lkZW50YSBkZSBsYSBSZXDDumJsaWNhIHF1ZSBpbnN0cnV5YSBhbCBNaW5pc3RybyBkZSBBZ3JpY3VsdHVyYSBlbiBvcmRlbiBhIHF1ZSByZXZpZXJ0YSBsYSBtZWRpZGEgZGUgY2llcnJlIGRlIGxhIGJhcnJlcmEgZGUgY29udHJvbCBzYW5pdGFyaW8gZGUgQ2hhY2FvLiINCghBcHJvYmFkbwQzNzEyZAIJDxYCHwQCARYCZg9kFgoCAQ9kFgICAQ8PFgIeD0NvbW1hbmRBcmd1bWVudAUBMGRkAgMPFgIfBWcWAmYPFQEBMWQCBQ9kFgICAQ8PFgIfBwUBMGQWAmYPFQEBMWQCBw9kFgICAQ8PFgIfBwUBMGRkAgkPZBYCAgEPDxYCHwcFATBkZGTTyHTIc6/yi0LwQqfOBkAe7NFpohkY5UYMEz7ExBmNyw==',
		'__VIEWSTATEGENERATOR':'E8353079',
		'__EVENTVALIDATION':'/wEdAB46ALuodWP7KfOkwmqPInzd79iXUm8v+P6RtHksFIuPKm6clNjm0ZGBlGQog/bdhYtvwuW55nONea3gh50Iwcm9NQuDWyvIz6JeUIgHwLZhpwIagcDacw0Px3Cw9oPIGOWbQJicO3pBhK56cZAVx+BQhUn1sE/pfCRtDozDTdYr7U8KVnOf9918GXNPp+/HL3o6Ucxonm6r3Gs8kDjPkiNN+PO+D42Go+vUCFWuTEv7367vB5TkymXoPH3hkqJl8X0eO8PBldAsEHdPqGn+FIXU5LMZD+NoXDWD2CI732oxyyJ2jyv5euTC69ceKShVbY2TNkrwfBdv8YUeOVrUkq+RMIS2apscjGS/154xolEumIWGvjItntO7hY1a6xCcyAEs/MqeKyJ+xNq0vopol+SmETKr/FGCdHvAwCYXc2nRS5/deuMLc3ahVSdZCDioTgfkLDJCkkZfeL5TzjYdVK5UeO7bb/vMQ8dA6SWHwv7c4zqTazRT0Pr87TMlkeeEX+IxmfRHPMVm+dYcupeDNhdd2VvlxUzdHhjaYVlYpORg9zrVBQxc3efDK3hajPFPv5wx0d/dZoF9JhxbMuXjIdEU1ViMCSALGQ6yK79N+wgVYu2EQdjYIVMb8hFYjsWXwR4pRsWQfruMlzGYfsqbUc3EeEGZs032EAQjgsM+2B2Acw==',
		'__ASYNCPOST':'false'
		})

	headers = {
	  'User-Agent': 'python',
	  'Content-Type': 'application/x-www-form-urlencoded',
	  }

	connection = httplib.HTTPSConnection(server)
	connection.request("POST", url+str(prmid), params, headers)
	
	response = connection.getresponse()
	
	print response.read()
	print response.status, response.reason
	
	connection.close()

def getPhoto(prmid):
  server 	= "www.camara.cl"
  url		= "img.aspx?prmid=g"
  
  headers = {
    'User-Agent': 'python',
    'Content-Type': 'application/x-www-form-urlencoded',
    }
  
  connection = httplib.HTTPSConnection(server)
  connection.request("GET", "/"+url+str(prmid))
  
  response = connection.getresponse()
     
  print response.status, response.reason
 
  if response.status == 200:
    f = open("concurso.jpg", 'wb')
    f.write(response.read())
    f.close()

#  i = Image.open(StringIO(response.read()))
#  i.save("concurso.jpg")
 
  connection.close()
  
  
getPhoto(972)